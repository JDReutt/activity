!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,t.isPlainObject(o)&&o),this.init()}var e=(window.FormData,"qor.activity"),o="enable."+e,r="disable."+e,a="click."+e,n="submit."+e,s=".qor-activity__edit-button",d=".qor-tab__activity",c=".qor-activity__edit-note_form",l=".qor-activity__new-note_form",_="#template__qor-activity__list",u=".qor-activity__lists";return i.prototype={constructor:i,init:function(){this.$element;this.bind(),this.initTabs()},bind:function(){this.$element.on(a,t.proxy(this.click,this)).on(n,"form",t.proxy(this.submit,this)),t(document).on(a,d,t.proxy(this.tabClick,this))},submit:function(i){var e,o=(i.target,t(i.target)),r=this;return i.preventDefault(),e=o.serialize(),t.ajax(o.prop("action"),{method:o.prop("method"),data:e,dataType:"json"}).done(function(i){i.errors||(o.is(c)&&(r.hideEditForm(o),o.find(".qor-activity__list-note").html(i.Note)),o.is(l)&&(t(u).prepend(r.renderActivityList(i)),r.clearForm()))}),!1},renderActivityList:function(t){var e=i.ACTIVITY_LIST_TEMPLATE;return Mustache.parse(e),Mustache.render(e,t)},clearForm:function(){t('textarea[data-toggle="qor.redactor"]').redactor("code.set",""),t(l).find('[name="QorResource.Content"],[name="QorResource.Note"]').val("")},click:function(i){var e=t(i.target);if(i.stopPropagation(),e.is(s)){var o=e.closest(".qor-activity__list");this.showEditForm(o)}},tabClick:function(i){var e=this,o=t(u).find(".qor-activity__list").size();if(!o){var r=t(d).data("actionId"),a="/admin/orders/"+r+"/!qor_activities";o?t(u).find(".mdl-spinner").remove():t.ajax({url:a,method:"GET",dataType:"json",success:function(i){if(i.length){t(u).html("");for(var o=i.length-1;o>=0;o--)t(u).append(e.renderActivityList(i[o]))}t(u).find(".mdl-spinner").remove()}})}},showEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("show").addClass("hide"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("hide").addClass("show")},hideEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("hide").addClass("show"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("show").addClass("hide")},initTabs:function(){t(".qor-slideout.is-shown").get(0)||(i.ACTIVITY_LIST_TEMPLATE=t(_).html(),t(".qor-page__body").append(i.CONTENT_HTML),t(".qor-form-container").appendTo(t("#scroll-tab-form")),t("#scroll-tab-activity").appendTo(".mdl-layout__content"),t(".qor-page__header .qor-tab-bar--activity-header").prependTo(".mdl-layout.qor-sliderout__activity-container"),t(".qor-page .qor-page__header").hide(),t(".qor-layout .mdl-layout__content.has-header").removeClass("has-header"),t(".qor-page").css("position","relative"),t(".qor-page__header + .qor-page__body").css("padding-top","0"),t(".qor-page .mdl-layout__container").css("position","relative"),t(".qor-sliderout__activity-container").css("margin","0"),t("#scroll-tab-activity").wrapInner('<div class="qor-form-container"></div>'))}},i.CONTENT_HTML='<div class="mdl-layout mdl-js-layout qor-sliderout__activity-container"><main class="mdl-layout__content qor-slideout--activity-content"><div class="mdl-layout__tab-panel is-active" id="scroll-tab-form"></div></main></div>',i.DEFAULTS={},i.ACTIVITY_LIST_TEMPLATE={},i.plugin=function(o){return this.each(function(){var r,a=t(this),n=a.data(e);if(!n){if(/destroy/.test(o))return;a.data(e,n=new i(this,o))}"string"==typeof o&&t.isFunction(r=n[o])&&r.apply(n)})},t.fn.qorSliderAfterShow.qorActivityinit=function(e,o){var r=t(".qor-slideout > .qor-slideout__body"),a=t(".qor-slideout .qor-tab-bar--activity-header");i.ACTIVITY_LIST_TEMPLATE=t(_).html(),r.wrapInner(i.CONTENT_HTML),t(".qor-slideout .qor-page__header").hide(),t(".qor-sliderout__activity-container").prepend(a),t(".qor-slideout--activity-content").append(t(".qor-slideout #scroll-tab-activity"))},t(function(){var e='[data-toggle="qor.activity"]';t(document).on(r,function(o){i.plugin.call(t(e,o.target),"destroy")}).on(o,function(o){i.plugin.call(t(e,o.target))}).triggerHandler(o)}),i});