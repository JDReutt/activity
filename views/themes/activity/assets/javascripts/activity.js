!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(e,o){this.$element=t(e),this.options=t.extend({},i.DEFAULTS,t.isPlainObject(o)&&o),this.init()}var e=(window.FormData,window.Mustache),o="qor.activity",r="enable."+o,a="disable."+o,n="click."+o,s="submit."+o,d=".qor-activity__edit-button",c=".qor-tab__activity",l=".qor-activity__edit-note_form",_=".qor-activity__new-note_form",u="#template__qor-activity__list",v=".qor-activity__lists";return i.prototype={constructor:i,init:function(){this.$element;this.bind(),this.initTabs()},bind:function(){this.$element.on(n,t.proxy(this.click,this)).on(s,"form",t.proxy(this.submit,this)),t(document).on(n,c,t.proxy(this.tabClick,this))},submit:function(i){var e,o=(i.target,t(i.target)),r=this;return i.preventDefault(),e=o.serialize(),t.ajax(o.prop("action"),{method:o.prop("method"),data:e,dataType:"json"}).done(function(i){i.errors||(o.is(l)&&(r.hideEditForm(o),o.find(".qor-activity__list-note").html(i.Note)),o.is(_)&&(t(v).prepend(r.renderActivityList(i)),r.clearForm()))}),!1},renderActivityList:function(t){var o=i.ACTIVITY_LIST_TEMPLATE;return e.parse(o),e.render(o,t)},clearForm:function(){t('textarea[data-toggle="qor.redactor"]').redactor("code.set",""),t(_).find('[name="QorResource.Content"],[name="QorResource.Note"]').val("")},click:function(i){var e=t(i.target);if(i.stopPropagation(),e.is(d)){var o=e.closest(".qor-activity__list");this.showEditForm(o)}},tabClick:function(i){var e=this,o=t(v).find(".qor-activity__list").size();if(!o){var r=t(c).data("actionId"),a="/admin/orders/"+r+"/!qor_activities";o?t(v).find(".mdl-spinner").remove():t.ajax({url:a,method:"GET",dataType:"json",success:function(i){if(i.length){t(v).html("");for(var o=i.length-1;o>=0;o--)t(v).prepend(e.renderActivityList(i[o]))}t(v).find(".mdl-spinner").remove()}})}},showEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("show").addClass("hide"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("hide").addClass("show")},hideEditForm:function(t){t.find(".qor-activity__list-note,.qor-activity__edit-button").removeClass("hide").addClass("show"),t.find(".qor-activity__edit-feilds,.qor-activity__edit-save-button").removeClass("show").addClass("hide")},initTabs:function(){t(".qor-slideout.is-shown").get(0)||(i.ACTIVITY_LIST_TEMPLATE=t(u).html(),t(".qor-page__body").append(i.CONTENT_HTML),t(".qor-form-container").appendTo(t("#scroll-tab-form")),t("#scroll-tab-activity").appendTo(".mdl-layout__content"),t(".qor-page__header .qor-tab-bar--activity-header").prependTo(".mdl-layout.qor-sliderout__activity-container"),t(".qor-page > .qor-page__header").hide(),t(".qor-page > .qor-page__header .qor-action-forms").prependTo("#scroll-tab-form"),t(".qor-layout .mdl-layout__content.has-header").removeClass("has-header"),t("#scroll-tab-activity").wrapInner('<div class="qor-form-container"></div>'))}},i.CONTENT_HTML='<div class="mdl-layout mdl-js-layout qor-sliderout__activity-container"><main class="mdl-layout__content qor-slideout--activity-content"><div class="mdl-layout__tab-panel is-active" id="scroll-tab-form"></div></main></div>',i.DEFAULTS={},i.ACTIVITY_LIST_TEMPLATE={},i.plugin=function(e){return this.each(function(){var r,a=t(this),n=a.data(o);if(!n){if(/destroy/.test(e))return;a.data(o,n=new i(this,e))}"string"==typeof e&&t.isFunction(r=n[e])&&r.apply(n)})},t.fn.qorSliderAfterShow.qorActivityinit=function(e,o){var r=t(".qor-slideout > .qor-slideout__body"),a=t(".qor-slideout .qor-tab-bar--activity-header");i.ACTIVITY_LIST_TEMPLATE=t(u).html(),r.wrapInner(i.CONTENT_HTML),t(".qor-sliderout__activity-container").prepend(a),t(".qor-slideout--activity-content").append(t(".qor-slideout #scroll-tab-activity"))},t(function(){var e='[data-toggle="qor.activity"]';t(document).on(a,function(o){i.plugin.call(t(e,o.target),"destroy")}).on(r,function(o){i.plugin.call(t(e,o.target))}).triggerHandler(r)}),i});